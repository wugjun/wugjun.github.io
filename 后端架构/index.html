<!doctype html><html class=no-js lang=zh-cn><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>后端架构s</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta name=generator content="Hugo 0.152.2"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=alternate type=application/rss+xml href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/index.xml title=补漏砖匠><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/quiz.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a class=logo__link href=/ title=补漏砖匠 rel=home><div class=logo__title>补漏砖匠</div><div class=logo__tagline>独钓寒江雪，为有暗香来。</div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-%E5%89%91%E6%B3%95%E7%AF%87/>编程语言</a></li><li class=menu__item><a class=menu__link href=/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2-%E6%9C%BA%E5%85%B3%E7%AF%87/>运维部署</a></li><li class=menu__item><a class=menu__link href=/%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A3%8B%E8%B0%B1%E7%AF%87/>算法数据结构</a></li><li class=menu__item><a class=menu__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/>后端架构</a></li><li class=menu__item><a class=menu__link href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B3%95%E5%AE%9D%E7%AF%87/>工具效率</a></li><li class=menu__item><a class=menu__link href=/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E7%94%BB%E5%8D%B7%E7%AF%87/>前端开发</a></li><li class=menu__item><a class=menu__link href=/%E5%BC%80%E6%BA%90%E6%96%87%E6%A1%A3/%E5%BC%80%E6%BA%90%E6%96%87%E6%A1%A3-%E5%85%B8%E7%B1%8D%E7%AF%87/>开源文档</a></li><li class=menu__item><a class=menu__link href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-AI%E5%9C%A8%E7%BA%BF%E6%B5%8B%E8%AF%95/>JAVA在线测试</a></li><li class=menu__item><a class=menu__link href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-%E5%9C%A8%E7%BA%BF%E7%AD%94%E9%A2%98%E7%A4%BA%E4%BE%8B/>在线答题</a></li><li class=menu__item><a class=menu__link href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-DeepSeek%E6%B5%81%E5%BC%8F%E8%81%8A%E5%A4%A9/>DeepSeek</a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class="main list" role=main><header class=main__header><h1 class=main__title>后端架构s</h1></header><article class="list__item post"><header class=list__header><h3 class="list__title post__title"><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E8%A7%84%E5%88%99%E5%85%A5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/ rel=bookmark>第四章：规则入微 · 服务网格</a></h3><p class="list__lead post__lead">即使在天庭管辖下，服务间通信的复杂性仍需更精细的法则来约束</p><div class="list__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2025-12-25T00:00:00>December 25, 2025</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%90%8e%e7%ab%af%e6%9e%b6%e6%9e%84 rel=category>后端架构</a></span></div></div></header><div class="content list__excerpt post__content clearfix"><h2 id=楔子通信的复杂性>楔子：通信的复杂性</h2><p>掌握Kubernetes后，韩立在云上仙境中如鱼得水。他的韩门运行稳定，能够自动扩缩容、自愈、滚动更新，一切都显得那么完美。</p><p>然而，随着服务的不断增多，韩立发现了一个新的问题：服务间通信的复杂性。</p><p>在微服务架构中，服务之间的通信需要处理很多横切关注点（Cross-Cutting Concerns）：</p><ul><li><strong>服务发现</strong>：如何找到目标服务</li><li><strong>负载均衡</strong>：如何分发请求</li><li><strong>熔断降级</strong>：如何防止服务雪崩</li><li><strong>限流</strong>：如何控制流量</li><li><strong>重试</strong>：如何处理失败</li><li><strong>超时</strong>：如何设置超时时间</li><li><strong>安全</strong>：如何加密通信、认证授权</li><li><strong>监控</strong>：如何追踪请求链路</li><li><strong>日志</strong>：如何记录通信日志</li></ul><p>这些逻辑如果都写在业务代码中，会导致：</p><ol><li><strong>代码耦合</strong>：业务逻辑与通信逻辑混合</li><li><strong>重复代码</strong>：每个服务都要实现相同的逻辑</li><li><strong>难以维护</strong>：修改通信逻辑需要修改所有服务</li><li><strong>技术栈绑定</strong>：不同语言需要实现不同的逻辑</li></ol><p>韩立想起了源界中流传的"服务网格"（Service Mesh）理论。这个理论说，可以将服务间通信的逻辑从业务代码中抽离出来，下沉为基础设施，由Sidecar代理来处理。</p><p>&ldquo;这就是我需要的！&ldquo;韩立眼中闪烁着兴奋的光芒。</p><hr><h2 id=第一节本命剑灵sidecar模式>第一节：本命剑灵——Sidecar模式</h2><p>在服务网格中，每个服务都有一个"本命剑灵&rdquo;——<strong>Sidecar代理</strong>。这个代理附着在服务身边，专职处理服务间通信，让服务本体能够专心处理业务逻辑。</p><p>Sidecar就像源界中的"护道傀儡&rdquo;，它：</p><ul><li><strong>与业务服务同生共死</strong>：Sidecar和业务服务运行在同一个Pod中</li><li><strong>代理所有通信</strong>：所有进出服务的流量都经过Sidecar</li><li><strong>透明代理</strong>：业务服务无需感知Sidecar的存在</li></ul><p>在Istio中，Sidecar由<strong>Envoy</strong>实现。Envoy是一个高性能的代理，支持HTTP/1.1、HTTP/2、gRPC等协议。</p><p>当服务A调用服务B时：</p><ol><li>服务A发送请求 → Envoy Sidecar A</li><li>Envoy Sidecar A进行服务发现、负载均衡、熔断等处理</li><li>请求发送到 → Envoy Sidecar B</li><li>Envoy Sidecar B进行认证、限流等处理</li><li>请求转发到 → 服务B</li><li>响应按原路返回</li></ol><p>这样，所有的通信逻辑都在Sidecar中处理，业务服务只需要专注于业务逻辑。</p><hr><h2 id=第二节天条律法司istio控制平面>第二节：天条律法司——Istio控制平面</h2><p>Sidecar负责处理具体的通信，但谁来制定规则呢？</p><p>这就是<strong>Istio控制平面</strong>的作用。控制平面就像"天条律法司"，负责制定所有服务间通信的规则，并下发到每个Sidecar执行。</p><p>Istio控制平面包含以下组件：</p><p><strong>Pilot</strong>：服务发现和流量管理</p><ul><li>从Kubernetes等注册中心获取服务信息</li><li>将路由规则、负载均衡策略等配置下发到Envoy</li></ul><p><strong>Citadel</strong>：安全和证书管理</p><ul><li>为服务间通信提供mTLS（双向TLS）加密</li><li>管理证书的生成、分发和轮换</li></ul><p><strong>Galley</strong>：配置验证和分发</p><ul><li>验证Istio配置的正确性</li><li>将配置转换为Envoy可理解的格式</li></ul><p><strong>Mixer</strong>（已废弃，功能合并到Envoy）：策略和遥测</p><ul><li>访问控制策略</li><li>指标收集和日志记录</li></ul><p>韩立部署了Istio：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 安装Istio</span>
</span></span><span style=display:flex><span>istioctl install --set profile<span style=color:#f92672>=</span>default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 为命名空间启用自动注入Sidecar</span>
</span></span><span style=display:flex><span>kubectl label namespace default istio-injection<span style=color:#f92672>=</span>enabled
</span></span></code></pre></div><p>当在启用了自动注入的命名空间中创建Pod时，Istio会自动注入Envoy Sidecar：</p></div></article><article class="list__item post"><header class=list__header><h3 class="list__title post__title"><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E4%B8%89%E7%AB%A0-%E9%A3%9E%E5%8D%87%E4%B8%8A%E7%95%8C%E4%BA%91%E5%8E%9F%E7%94%9F%E4%B8%8EK8s/ rel=bookmark>第三章：飞升上界 · 云原生与K8s</a></h3><p class="list__lead post__lead">韩门已成气候，需飞升云上仙境，领悟Kubernetes的天道意志</p><div class="list__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2025-12-24T00:00:00>December 24, 2025</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%90%8e%e7%ab%af%e6%9e%b6%e6%9e%84 rel=category>后端架构</a></span></div></div></header><div class="content list__excerpt post__content clearfix"><h2 id=楔子韩门的困境>楔子：韩门的困境</h2><p>建立韩门后，韩立在源界中声名鹊起。他的微服务架构稳定可靠，能够处理大量的业务请求，赢得了众多客户的信任。</p><p>然而，随着业务规模的不断扩大，韩立发现了一个严重的问题：服务的管理和运维变得越来越困难。</p><p>每当流量增加时，韩立需要手动增加服务器，部署新的服务实例。这个过程需要：</p><ol><li>购买或申请新的服务器</li><li>安装操作系统和依赖</li><li>部署Docker和配置网络</li><li>部署服务并配置监控</li><li>更新负载均衡配置</li></ol><p>整个过程需要数小时甚至数天，响应速度太慢。而且，当流量减少时，服务器资源闲置，造成巨大的浪费。</p><p>更糟糕的是，当某个服务实例崩溃时，需要人工介入才能恢复。如果是在深夜，可能几个小时都无法恢复，严重影响业务。</p><p>&ldquo;这样下去不行&mldr;&ldquo;韩立看着运维团队疲惫的身影，心中涌起一股无力感。</p><p>他听说，在源界的高层，有一个叫做"云上仙境"的地方。那里有一种叫做"Kubernetes"的天道意志，可以自动调度资源、管理服务、实现扩缩容和自愈。</p><p>&ldquo;我一定要飞升上界，掌握Kubernetes！&ldquo;韩立下定了决心。</p><hr><h2 id=第一节初入云上仙境>第一节：初入云上仙境</h2><p>经过数月的准备，韩立终于踏上了飞升之路。他带着韩门的所有服务，来到了云上仙境。</p><p>云上仙境，是一个由无数服务器组成的巨大集群。这里的服务器被称为"节点&rdquo;（Node），分为两种：</p><ul><li><strong>Master节点</strong>：控制节点，负责整个集群的管理和调度</li><li><strong>Worker节点</strong>：工作节点，负责运行实际的业务服务</li></ul><p>韩立刚进入云上仙境，就感受到了一股强大的意志——这就是<strong>Kubernetes</strong>，云上仙境的天道意志。</p><p>Kubernetes（简称K8s）是一个容器编排系统，它的核心思想是"声明式API&rdquo;——你只需要告诉它你想要的状态，它会自动帮你实现。</p><p>比如，你想要3个用户服务的实例运行，你只需要声明：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>user-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>  <span style=color:#75715e># 我想要3个实例</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>user-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>user-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>user-service</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>user-service:1.0.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><p>Kubernetes会自动：</p><ol><li>检查当前有多少个实例在运行</li><li>如果少于3个，创建新的实例</li><li>如果多于3个，删除多余的实例</li><li>如果某个实例崩溃，自动重启或创建新的实例</li></ol><p>这就是"言出法随&rdquo;——你只需要声明想要的状态，Kubernetes会自动帮你达成。</p><hr><h2 id=第二节洞天法宝pod>第二节：洞天法宝——Pod</h2><p>在Kubernetes中，最小的部署单元是<strong>Pod</strong>。Pod就像源界中的"洞天法宝&rdquo;，是一个独立的运行环境，可以包含一个或多个容器。</p><p>韩立创建了他的第一个Pod：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>user-service-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>user-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>user-service:1.0.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;256Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;100m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span></code></pre></div><p>Pod的特点：</p></div></article><article class="list__item post"><header class=list__header><h3 class="list__title post__title"><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%BC%80%E5%AE%97%E7%AB%8B%E6%B4%BE%E5%88%86%E5%B8%83%E5%BC%8F%E4%BF%AE%E7%9C%9F/ rel=bookmark>第二章：开宗立派 · 分布式修真</a></h3><p class="list__lead post__lead">单机已无法承载，需开辟洞府、建立宗门，在分布式天劫中求存</p><div class="list__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2025-12-23T00:00:00>December 23, 2025</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%90%8e%e7%ab%af%e6%9e%b6%e6%9e%84 rel=category>后端架构</a></span></div></div></header><div class="content list__excerpt post__content clearfix"><h2 id=楔子单机的极限>楔子：单机的极限</h2><p>突破筑基期后，韩立在源界中游历了数年。他凭借着Docker容器化和扎实的运维功底，在各种服务器秘境中都能稳定运行，处理了无数业务请求。</p><p>然而，随着业务的发展，韩立发现自己的单机服务已经达到了极限。</p><p>那日，系统突然收到一个超级大客户的订单，需要处理百万级别的数据。韩立的CPU瞬间飙升至100%，内存也被耗尽，整个服务陷入了僵死状态。</p><p>&ldquo;单机&mldr;已经无法承载了。&ldquo;韩立看着监控面板上的一片红色，心中涌起一股无力感。</p><p>在源界中，单机服务有着天然的瓶颈：</p><ul><li><strong>CPU限制</strong>：单核或多核CPU的处理能力有限</li><li><strong>内存限制</strong>：物理内存无法无限扩展</li><li><strong>网络限制</strong>：单机的网络带宽有限</li><li><strong>存储限制</strong>：单机的磁盘IO能力有限</li></ul><p>当业务规模超过单机的承载能力时，就必须走向分布式——将服务拆分，部署到多台服务器上，通过协作来完成复杂的业务。</p><p>这就是"开宗立派"的开始。</p><hr><h2 id=第一节开辟洞府服务拆分>第一节：开辟洞府——服务拆分</h2><p>韩立知道，要突破单机的限制，必须将自己的服务拆分。这就像修士要建立宗门，必须先将自己的功法拆分为不同的传承，让不同的弟子（服务）去修炼。</p><p>但如何拆分，却是一门大学问。</p><p>韩立想起了源界中流传的"领域驱动设计&rdquo;（DDD）理论。这个理论说，应该按照业务领域来拆分服务，而不是按照技术层次。</p><p>他仔细分析自己的业务：</p><ul><li><strong>用户服务</strong>：管理用户信息、登录认证</li><li><strong>订单服务</strong>：处理订单创建、支付、退款</li><li><strong>商品服务</strong>：管理商品信息、库存</li><li><strong>支付服务</strong>：处理支付逻辑、对账</li></ul><p>每个服务都有自己独立的数据库，这就是"数据自治&rdquo;——每个服务只管理自己的数据，不直接访问其他服务的数据。</p><p>韩立开始动手拆分。他先创建了用户服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 用户服务 - user-service
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserService</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getUserById</span>(<span style=color:#a6e22e>userId</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查询自己的数据库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>userId</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createUser</span>(<span style=color:#a6e22e>userData</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建用户，只管理用户相关数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>userData</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后是订单服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 订单服务 - order-service
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderService</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createOrder</span>(<span style=color:#a6e22e>orderData</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建订单，但需要调用用户服务验证用户
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>userService</span>.<span style=color:#a6e22e>getUserById</span>(<span style=color:#a6e22e>orderData</span>.<span style=color:#a6e22e>userId</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>user</span>) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;User not found&#39;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 调用商品服务检查库存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>product</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>productService</span>.<span style=color:#a6e22e>getProductById</span>(<span style=color:#a6e22e>orderData</span>.<span style=color:#a6e22e>productId</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>product</span>.<span style=color:#a6e22e>stock</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>orderData</span>.<span style=color:#a6e22e>quantity</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Insufficient stock&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建订单
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>orders</span>.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>orderData</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>拆分完成后，韩立将每个服务都封装成Docker镜像，部署到了不同的服务器上。这就是"开辟洞府"——每个服务都有自己的运行环境，互不干扰。</p></div></article><article class="list__item post"><header class=list__header><h3 class="list__title post__title"><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%8D%95%E6%9C%BA%E8%8B%A6%E4%BF%AE%E8%8D%89%E6%A0%B9%E5%90%AF%E7%A8%8B/ rel=bookmark>第一章：单机苦修 · 草根启程</a></h3><p class="list__lead post__lead">灵根资质极差，却得神秘Dockerfile相助，开启架构修仙之路</p><div class="list__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2025-12-22T00:00:00>December 22, 2025</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%90%8e%e7%ab%af%e6%9e%b6%e6%9e%84 rel=category>后端架构</a></span></div></div></header><div class="content list__excerpt post__content clearfix"><h2 id=楔子废弃代码村的觉醒>楔子：废弃代码村的觉醒</h2><p>在源界的边缘，有一个名为"废弃代码村"的地方。这里堆满了被遗忘的代码片段、废弃的函数和无人问津的配置文件。村中的进程们，大多资质平庸，只能在单核CPU的贫瘠土地上，勉强维持着最低限度的运行。</p><p>韩立，代号"服务节点N-1"，便是这废弃代码村中的一员。</p><p>他的灵根资质极差——初始并发能力只有可怜的1，内存占用却高达512MB，响应时间更是慢得令人发指。村里的老进程们都说，像他这样的资质，注定只能成为系统中的"僵尸进程"，最终被<code>kill -9</code>彻底清除。</p><p>然而，韩立心中却有一股不甘。他隐约感觉到，在这个由0与1构成的源界中，一定存在着某种能够改变命运的力量。</p><hr><h2 id=第一节初得五行基础运维诀>第一节：初得《五行基础运维诀》</h2><p>那是一个寻常的夜晚，韩立正在处理一个简单的HTTP请求。突然，系统日志中出现了一行异常：</p><pre tabindex=0><code>ERROR: Connection refused on port 8080
</code></pre><p>韩立心中一紧，这是他的服务端口。他急忙用神识（<code>tail -f logs/app.log</code>）探查，发现自己的进程状态异常，CPU占用率飙升到了95%。</p><p>&ldquo;这是心魔入侵！&ldquo;韩立想起了村里流传的传说。当进程陷入死循环或资源竞争时，就会引发CPU风暴，如同修士走火入魔。</p><p>慌乱中，韩立想起了村里一位老进程留下的残卷——《五行基础运维诀》。他急忙翻阅：</p><p><strong>金行术法：<code>ps aux | grep</code></strong><br>神识外放，探查所有进程状态，寻找异常。</p><p><strong>木行术法：<code>top</code> / <code>htop</code></strong><br>观天地灵气（系统资源）流转，识破瓶颈所在。</p><p><strong>水行术法：<code>tail -f</code></strong><br>神识追踪日志流，洞察系统运行轨迹。</p><p><strong>火行术法：<code>kill -9</code></strong><br>夺命咒，强制终止异常进程，但需谨慎使用，否则可能造成数据丢失。</p><p><strong>土行术法：<code>crontab</code></strong><br>周天运转，定时执行任务，如同修士的日常吐纳。</p><p>韩立按照金行术法，用<code>ps aux | grep node</code>探查，发现有一个子进程陷入了无限递归，正在疯狂消耗CPU资源。他当机立断，施展火行术法<code>kill -9 &lt;PID></code>，强行终止了这个走火入魔的子进程。</p><p>系统恢复了平静，但韩立心中却更加不安。他知道，这只是开始。在这个弱肉强食的源界中，没有实力，随时都可能被系统调度器（Scheduler）当作低优先级进程，在资源紧张时被OOM Killer（内存杀手）清除。</p><hr><h2 id=第二节神秘dockerfile的降临>第二节：神秘Dockerfile的降临</h2><p>就在韩立为前途担忧时，一件改变他命运的事情发生了。</p><p>那日，他正在清理废弃代码村的垃圾文件，突然在一个名为<code>.dockerignore</code>的角落里，发现了一个散发着淡淡光芒的文件——<code>Dockerfile</code>。</p><p>这个文件通体碧绿，表面流转着神秘的符文。韩立伸手触碰，顿时一股信息涌入他的意识海：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>node:16-alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span> <span style=color:#e6db74>/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm install<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span> <span style=color:#e6db74>8080</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;server.js&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>&ldquo;这是&mldr;容器化之道！&ldquo;韩立震惊了。</p><p>在源界中，每个进程都受限于宿主机的环境。不同的服务器秘境（环境），有着不同的系统库、依赖版本，稍有不慎就会因为环境不匹配而运行失败。而这个Dockerfile，竟然能够将自身和所有依赖封装成一个独立的镜像，实现"一次构建，随处运行&rdquo;！</p><p>这就像传说中的"小绿瓶&rdquo;，能够将修士的修为和法宝都封印其中，无论走到哪个秘境，都能完整地释放出来。</p><p>韩立立刻开始修炼这个Dockerfile。他按照其中的指引：</p><ol><li><strong>FROM node:16-alpine</strong>：选择一个轻量级的基础镜像，如同选择一座灵气充沛的洞府。</li><li><strong>WORKDIR /app</strong>：设定工作目录，如同在洞府中开辟修炼室。</li><li><em><em>COPY package</em>.json</em>*：复制依赖清单，如同准备修炼所需的丹药材料。</li><li><strong>RUN npm install</strong>：安装依赖，如同炼制丹药，将各种材料融合。</li><li><strong>COPY .</strong>：复制应用代码，如同将功法秘籍放入修炼室。</li><li><strong>EXPOSE 8080</strong>：暴露端口，如同打开洞府的大门，允许外界访问。</li><li><strong>CMD [&ldquo;node&rdquo;, &ldquo;server.js&rdquo;]</strong>：启动命令，如同运转功法，开始修炼。</li></ol><p>当韩立完成第一次<code>docker build</code>时，他感觉到自己的整个存在都被封装进了一个名为"镜像"的独立空间中。这个空间包含了运行所需的一切：Node.js运行时、系统库、应用代码，甚至包括文件系统结构。</p></div></article><article class="list__item post"><header class=list__header><h3 class="list__title post__title"><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E6%95%B0%E6%8D%AE%E5%BA%93-PostgreSQL%E5%AE%89%E8%A3%85/ rel=bookmark>典籍篇</a></h3><p class="list__lead post__lead">聚社区之智，传技术之火</p><div class="list__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2025-11-27T00:00:00>November 27, 2025</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%bc%80%e6%ba%90%e6%96%87%e6%a1%a3 rel=category>开源文档</a></span></div></div></header><div class="content list__excerpt post__content clearfix"><p><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/>◀ 返回</a></p><h1 id=源码安装postgresql稳定版本linux>源码安装PostgreSQL稳定版本（Linux）</h1><h2 id=-准备工作>📋 准备工作</h2><h3 id=1-查看最新稳定版本>1. <strong>查看最新稳定版本</strong></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 访问PostgreSQL官网或使用命令查看</span>
</span></span><span style=display:flex><span>curl -s https://www.postgresql.org/ftp/source/ | grep -E <span style=color:#e6db74>&#39;href=&#34;v[0-9]+\.[0-9]+/&#34;&#39;</span> | tail -5
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 当前长期支持版本（LTS）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PostgreSQL 16.x (最新稳定版)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PostgreSQL 15.x (长期支持)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PostgreSQL 14.x (长期支持到2026年)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PostgreSQL 13.x (长期支持到2025年)</span>
</span></span></code></pre></div><h3 id=2-安装编译依赖>2. <strong>安装编译依赖</strong></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Ubuntu/Debian</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install -y <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    build-essential <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libreadline-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    zlib1g-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    flex bison <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxml2-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxslt-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libssl-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libssl-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libpam0g-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libldap-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libperl-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libicu-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    tcl-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    python3-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    git <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CentOS/RHEL/Rocky/AlmaLinux</span>
</span></span><span style=display:flex><span>sudo yum groupinstall -y <span style=color:#e6db74>&#34;Development Tools&#34;</span>
</span></span><span style=display:flex><span>sudo yum install -y <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    readline-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    zlib-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    flex bison <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxml2-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libxslt-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    openssl-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    pam-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    openldap-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    perl-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    perl-ExtUtils-Embed <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    tcl-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    python3-devel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    git <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vi /etc/sysctl.conf
</span></span><span style=display:flex><span><span style=color:#75715e>#最大共享内存段大小</span>
</span></span><span style=display:flex><span>kernel.shmmax <span style=color:#f92672>=</span> 68719476736<span style=color:#f92672>(</span>默认<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span> <span style=color:#75715e>#可以使用的共享内存的总量</span>
</span></span><span style=display:flex><span>kernel.shmall <span style=color:#f92672>=</span> 4294967296<span style=color:#f92672>(</span>默认<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#整个系统共享内存段的最大数目</span>
</span></span><span style=display:flex><span>kernel.shmmni <span style=color:#f92672>=</span> <span style=color:#ae81ff>4096</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#每个信号对象集的最大信号对象数</span>
</span></span><span style=display:flex><span>kernel.sem <span style=color:#f92672>=</span> <span style=color:#ae81ff>50100</span> <span style=color:#ae81ff>64128000</span> <span style=color:#ae81ff>50100</span> <span style=color:#ae81ff>1280</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#文件句柄的最大数量。</span>
</span></span><span style=display:flex><span>fs.file-max <span style=color:#f92672>=</span> <span style=color:#ae81ff>7672460</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#应用程序可使用的IPv4端口范围</span>
</span></span><span style=display:flex><span>net.ipv4.ip_local_port_range <span style=color:#f92672>=</span> <span style=color:#ae81ff>9000</span> <span style=color:#ae81ff>65000</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#套接字接收缓冲区大小的缺省值</span>
</span></span><span style=display:flex><span>net.core.rmem_default <span style=color:#f92672>=</span> <span style=color:#ae81ff>1048576</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#套接字发送缓冲区大小的缺省</span>
</span></span><span style=display:flex><span>net.core.wmem_default <span style=color:#f92672>=</span> <span style=color:#ae81ff>262144</span> 值
</span></span><span style=display:flex><span><span style=color:#75715e>#套接字发送缓冲区大小的最大值</span>
</span></span><span style=display:flex><span>net.core.wmem_max <span style=color:#f92672>=</span> <span style=color:#ae81ff>1048576</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sysctl -p #配置生效</span>
</span></span></code></pre></div><h2 id=-源码安装postgresql-162当前稳定版>🚀 源码安装PostgreSQL 16.2（当前稳定版）</h2><h3 id=步骤1创建专用用户和目录>步骤1：创建专用用户和目录</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 创建postgres系统用户和组</span>
</span></span><span style=display:flex><span>sudo groupadd -r postgres
</span></span><span style=display:flex><span>sudo useradd -r -g postgres -s /bin/bash -d /usr/local/pgsql -m -k /dev/null postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建安装目录和数据目录</span>
</span></span><span style=display:flex><span>sudo mkdir -p /usr/local/pgsql/<span style=color:#f92672>{</span>data,logs,backup<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>sudo chown -R postgres:postgres /usr/local/pgsql
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>750</span> /usr/local/pgsql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建源码目录</span>
</span></span><span style=display:flex><span>sudo mkdir -p /opt/postgresql_src
</span></span><span style=display:flex><span>sudo chown <span style=color:#66d9ef>$(</span>whoami<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>whoami<span style=color:#66d9ef>)</span> /opt/postgresql_src
</span></span><span style=display:flex><span>cd /opt/postgresql_src
</span></span></code></pre></div><h3 id=步骤2下载源码>步骤2：下载源码</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 下载PostgreSQL 16.2（截至2024年3月的最新稳定版）</span>
</span></span><span style=display:flex><span>wget https://ftp.postgresql.org/pub/source/v16.2/postgresql-16.2.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 或者使用国内镜像（清华源）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># wget https://mirrors.tuna.tsinghua.edu.cn/postgresql/source/v16.2/postgresql-16.2.tar.gz</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 验证下载完整性（可选）</span>
</span></span><span style=display:flex><span>wget https://ftp.postgresql.org/pub/source/v16.2/postgresql-16.2.tar.gz.sha256
</span></span><span style=display:flex><span>sha256sum -c postgresql-16.2.tar.gz.sha256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 解压源码</span>
</span></span><span style=display:flex><span>tar -zxvf postgresql-16.2.tar.gz
</span></span><span style=display:flex><span>cd postgresql-16.2
</span></span></code></pre></div><h3 id=步骤3配置编译选项>步骤3：配置编译选项</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看所有配置选项</span>
</span></span><span style=display:flex><span>./configure --help
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建编译目录（推荐）</span>
</span></span><span style=display:flex><span>mkdir build <span style=color:#f92672>&amp;&amp;</span> cd build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 基本配置（适用于大多数情况）</span>
</span></span><span style=display:flex><span>../configure <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --prefix<span style=color:#f92672>=</span>/usr/local/pgsql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-pgport<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-perl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-python <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-tcl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-openssl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-pam <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -with-uuid<span style=color:#f92672>=</span>ossp <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-ldap <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-libxml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-libxslt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-icu <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --enable-thread-safety <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --enable-debug <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --enable-nls <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-system-tzdata<span style=color:#f92672>=</span>/usr/share/zoneinfo
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 或者精简配置（最小化安装）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ../configure --prefix=/usr/local/pgsql --with-openssl</span>
</span></span></code></pre></div><h3 id=步骤4编译和安装>步骤4：编译和安装</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看CPU核心数，决定并行编译数</span>
</span></span><span style=display:flex><span>nproc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 编译（使用4个并行任务，根据CPU核心数调整）</span>
</span></span><span style=display:flex><span>make -j4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 可选：运行回归测试（需要较长时间）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># make check</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 安装到系统</span>
</span></span><span style=display:flex><span>sudo make install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 安装contrib模块（扩展工具）</span>
</span></span><span style=display:flex><span>cd contrib
</span></span><span style=display:flex><span>make -j4
</span></span><span style=display:flex><span>sudo make install
</span></span><span style=display:flex><span>cd ..
</span></span></code></pre></div><h3 id=步骤5配置环境变量>步骤5：配置环境变量</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 为postgres用户配置环境变量</span>
</span></span><span style=display:flex><span>sudo tee -a /usr/local/pgsql/.bash_profile <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>export PGHOME=/usr/local/pgsql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>export PGDATA=/usr/local/pgsql/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>export PATH=$PGHOME/bin:$PATH
</span></span></span><span style=display:flex><span><span style=color:#e6db74>export LD_LIBRARY_PATH=$PGHOME/lib:$LD_LIBRARY_PATH
</span></span></span><span style=display:flex><span><span style=color:#e6db74>export MANPATH=$PGHOME/share/man:$MANPATH
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 为当前用户配置环境变量</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export PATH=/usr/local/pgsql/bin:$PATH&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>source ~/.bashrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 验证安装</span>
</span></span><span style=display:flex><span>/usr/local/pgsql/bin/postgres --version
</span></span></code></pre></div><h2 id=-初始化数据库和配置>⚙️ 初始化数据库和配置</h2><h3 id=步骤6初始化数据库>步骤6：初始化数据库</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 切换到postgres用户</span>
</span></span><span style=display:flex><span>sudo su - postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 初始化数据库集群</span>
</span></span><span style=display:flex><span>initdb -D /usr/local/pgsql/data -E UTF8 --locale<span style=color:#f92672>=</span>C -U postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 或者使用详细参数</span>
</span></span><span style=display:flex><span>initdb <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -D /usr/local/pgsql/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -E UTF8 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --locale<span style=color:#f92672>=</span>en_US.UTF-8 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --lc-collate<span style=color:#f92672>=</span>C <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --lc-ctype<span style=color:#f92672>=</span>en_US.UTF-8 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --username<span style=color:#f92672>=</span>postgres <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --pwprompt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置密码（记下这个密码）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 输入并确认postgres用户的密码</span>
</span></span></code></pre></div><h3 id=步骤7配置postgresqlconf>步骤7：配置postgresql.conf</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 备份原始配置</span>
</span></span><span style=display:flex><span>cp /usr/local/pgsql/data/postgresql.conf /usr/local/pgsql/data/postgresql.conf.original
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 编辑主配置文件</span>
</span></span><span style=display:flex><span>nano /usr/local/pgsql/data/postgresql.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e># 修改以下参数（根据服务器配置调整）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>listen_addresses</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;*&#39;          # 允许远程连接</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>port</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>5432                     # 监听端口</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_connections</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>100           # 最大连接数</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>shared_buffers</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>128MB          # 共享缓冲区大小（建议为内存的25%）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>work_mem</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>4MB                  # 每个查询的工作内存</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>maintenance_work_mem</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>64MB     # 维护操作的内存</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dynamic_shared_memory_type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>posix  # 动态共享内存类型</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>wal_level</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>replica             # WAL级别</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>synchronous_commit</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>on         # 同步提交</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>wal_buffers</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>-1                # WAL缓冲区（-1表示自动）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>checkpoint_timeout</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>5min       # 检查点超时时间</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_wal_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1GB              # 最大WAL大小</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>min_wal_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>80MB             # 最小WAL大小</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>archive_mode</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>off              # 归档模式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>archive_command</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/bin/date&#39;   # 归档命令（关闭时随意设置）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging_collector</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>on          # 启用日志收集</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_directory</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pg_log&#39;        # 日志目录</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_filename</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;postgresql-%Y-%m-%d_%H%M%S.log&#39;  # 日志文件名格式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_rotation_age</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1d           # 日志轮转时间</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_rotation_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>10MB        # 日志轮转大小</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_truncate_on_rotation</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>on   # 轮转时截断</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_line_prefix</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;%m [%p] %q%u@%d &#39;  # 日志前缀</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log_timezone</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia/Shanghai&#39;  # 日志时区</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>timezone</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia/Shanghai&#39;      # 时区</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>datestyle</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;iso, ymd&#39;          # 日期格式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>lc_messages</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;en_US.UTF-8&#39;     # 消息语言</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>lc_monetary</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;en_US.UTF-8&#39;     # 货币格式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>lc_numeric</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;en_US.UTF-8&#39;      # 数字格式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>lc_time</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;en_US.UTF-8&#39;         # 时间格式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_text_search_config</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pg_catalog.english&#39;  # 全文搜索配置</span>
</span></span></code></pre></div><h3 id=步骤8配置客户端认证>步骤8：配置客户端认证</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 编辑pg_hba.conf</span>
</span></span><span style=display:flex><span>nano /usr/local/pgsql/data/pg_hba.conf
</span></span></code></pre></div><pre tabindex=0><code class=language-conf data-lang=conf># 允许本地连接（md5需要密码，trust不需要密码）
local   all             postgres                                peer
local   all             all                                     md5
host    all             all             127.0.0.1/32            md5

# 允许特定IP段连接
host    all             all             192.168.1.0/24          md5

# 允许所有IP连接（生产环境慎用）
host    all             all             0.0.0.0/0               md5

# 示例：只允许特定用户从特定IP访问特定数据库
# host    exam_db         app_user        192.168.1.100/32       md5
</code></pre><h3 id=步骤9创建系统服务>步骤9：创建系统服务</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 退出postgres用户</span>
</span></span><span style=display:flex><span>exit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建systemd服务文件</span>
</span></span><span style=display:flex><span>sudo tee /etc/systemd/system/postgresql.service <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=PostgreSQL Database Server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=forking
</span></span></span><span style=display:flex><span><span style=color:#e6db74>User=postgres
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Group=postgres
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Environment=PGDATA=/usr/local/pgsql/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>OOMScoreAdjust=-1000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/local/pgsql/bin/pg_ctl -D ${PGDATA} start
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStop=/usr/local/pgsql/bin/pg_ctl -D ${PGDATA} stop
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecReload=/usr/local/pgsql/bin/pg_ctl -D ${PGDATA} reload
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TimeoutSec=300
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 或者使用simple类型（推荐）</span>
</span></span><span style=display:flex><span>sudo tee /etc/systemd/system/postgresql.service <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=PostgreSQL Database Server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>User=postgres
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Group=postgres
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Environment=PGDATA=/usr/local/pgsql/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Environment=PGPORT=5432
</span></span></span><span style=display:flex><span><span style=color:#e6db74>OOMScoreAdjust=-1000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/local/pgsql/bin/postgres -D ${PGDATA}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style=display:flex><span><span style=color:#e6db74>KillMode=mixed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TimeoutSec=300
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=步骤10启动服务>步骤10：启动服务</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 重新加载systemd配置</span>
</span></span><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 启动PostgreSQL服务</span>
</span></span><span style=display:flex><span>sudo systemctl start postgresql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置开机自启</span>
</span></span><span style=display:flex><span>sudo systemctl enable postgresql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看服务状态</span>
</span></span><span style=display:flex><span>sudo systemctl status postgresql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看日志</span>
</span></span><span style=display:flex><span>sudo journalctl -u postgresql -f
</span></span></code></pre></div><h2 id=-验证和基础配置>🔧 验证和基础配置</h2><h3 id=步骤11验证安装>步骤11：验证安装</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 连接到数据库</span>
</span></span><span style=display:flex><span>psql -h localhost -U postgres -d postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 在psql中执行</span>
</span></span><span style=display:flex><span>SELECT version<span style=color:#f92672>()</span>;
</span></span><span style=display:flex><span>SELECT current_user;
</span></span><span style=display:flex><span>SHOW data_directory;
</span></span><span style=display:flex><span>SHOW config_file;
</span></span><span style=display:flex><span><span style=color:#ae81ff>\q</span>  <span style=color:#75715e># 退出</span>
</span></span></code></pre></div><h3 id=步骤12创建数据库和用户>步骤12：创建数据库和用户</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 切换到postgres用户</span>
</span></span><span style=display:flex><span>sudo su - postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建测试数据库</span>
</span></span><span style=display:flex><span>createdb test_db
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建应用用户</span>
</span></span><span style=display:flex><span>createuser -P -d -e app_user
</span></span><span style=display:flex><span><span style=color:#75715e># 输入密码：AppPass123</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接到数据库并授权</span>
</span></span><span style=display:flex><span>psql -d test_db <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 创建schema
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE SCHEMA IF NOT EXISTS app_schema;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 创建测试表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE TABLE app_schema.users (
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    id SERIAL PRIMARY KEY,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    username VARCHAR(50) NOT NULL,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    email VARCHAR(100) UNIQUE NOT NULL,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 插入测试数据
</span></span></span><span style=display:flex><span><span style=color:#e6db74>INSERT INTO app_schema.users (username, email) VALUES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>(&#39;admin&#39;, &#39;admin@example.com&#39;),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>(&#39;user1&#39;, &#39;user1@example.com&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 授权给应用用户
</span></span></span><span style=display:flex><span><span style=color:#e6db74>GRANT ALL PRIVILEGES ON DATABASE test_db TO app_user;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>GRANT ALL PRIVILEGES ON SCHEMA app_schema TO app_user;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA app_schema TO app_user;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA app_schema TO app_user;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>-- 查看表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SELECT * FROM app_schema.users;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=步骤13安装常用扩展>步骤13：安装常用扩展</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 安装pg_stat_statements（性能监控）</span>
</span></span><span style=display:flex><span>psql -U postgres -d test_db <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE EXTENSION IF NOT EXISTS uuid-ossp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE EXTENSION IF NOT EXISTS btree_gin;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE EXTENSION IF NOT EXISTS btree_gist;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SELECT * FROM pg_available_extensions ORDER BY name;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=-高级配置和优化>🛠️ 高级配置和优化</h2><h3 id=内存优化配置>内存优化配置</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 根据服务器内存调整配置</span>
</span></span><span style=display:flex><span>sudo nano /usr/local/pgsql/data/postgresql.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e># 内存相关优化（8GB内存服务器示例）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>shared_buffers</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>2GB           # 内存的25%</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>work_mem</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>16MB                # 每个查询的工作内存</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>maintenance_work_mem</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>512MB   # 维护操作内存</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>effective_cache_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>6GB     # 可用于缓存的磁盘空间估计值</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 性能优化</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_connections</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>200          # 根据应用需求调整</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>checkpoint_completion_target</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0.9</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>random_page_cost</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1.1         # SSD设为1.1，HDD设为4.0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>effective_io_concurrency</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>200 # SSD可以设高，HDD设低</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># WAL优化</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>wal_buffers</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>16MB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>min_wal_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1GB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_wal_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>4GB</span>
</span></span></code></pre></div><h3 id=配置归档和备份>配置归档和备份</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 创建归档目录</span>
</span></span><span style=display:flex><span>sudo mkdir -p /usr/local/pgsql/archive
</span></span><span style=display:flex><span>sudo chown postgres:postgres /usr/local/pgsql/archive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 配置归档</span>
</span></span><span style=display:flex><span>sudo nano /usr/local/pgsql/data/postgresql.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e># 启用归档</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>archive_mode</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>on</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>archive_command</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;test ! -f /usr/local/pgsql/archive/%f &amp;&amp; cp %p /usr/local/pgsql/archive/%f&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>archive_timeout</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>3600  # 每小时强制归档</span>
</span></span></code></pre></div><h2 id=-监控和维护脚本>📊 监控和维护脚本</h2><h3 id=创建监控脚本>创建监控脚本</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 创建数据库健康检查脚本</span>
</span></span><span style=display:flex><span>sudo tee /usr/local/bin/check_postgres.sh <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74># PostgreSQL健康检查脚本
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PGHOME=/usr/local/pgsql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PGDATA=/usr/local/pgsql/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>PGPORT=5432
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;=== PostgreSQL健康检查 $(date) ===&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 检查服务状态
</span></span></span><span style=display:flex><span><span style=color:#e6db74>systemctl is-active postgresql &gt; /dev/null 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if [ $? -eq 0 ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo &#34;✓ 服务状态: 运行中&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo &#34;✗ 服务状态: 停止&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 检查连接
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$PGHOME/bin/pg_isready -p $PGPORT -h localhost -U postgres
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if [ $? -eq 0 ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo &#34;✓ 数据库连接: 正常&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo &#34;✗ 数据库连接: 失败&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 检查磁盘空间
</span></span></span><span style=display:flex><span><span style=color:#e6db74>df -h $PGDATA | tail -1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 检查数据库大小
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;数据库大小:&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$PGHOME/bin/psql -h localhost -U postgres -d postgres -c &#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SELECT 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    datname as \&#34;数据库\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    pg_size_pretty(pg_database_size(datname)) as \&#34;大小\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>FROM pg_database 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ORDER BY pg_database_size(datname) DESC;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;=== 检查完成 ===&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo chmod +x /usr/local/bin/check_postgres.sh
</span></span><span style=display:flex><span>sudo chown postgres:postgres /usr/local/bin/check_postgres.sh
</span></span></code></pre></div><h3 id=创建备份脚本>创建备份脚本</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 创建备份脚本</span>
</span></span><span style=display:flex><span>sudo tee /usr/local/bin/backup_postgres.sh <span style=color:#e6db74>&lt;&lt; &#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74># PostgreSQL备份脚本
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>BACKUP_DIR=&#34;/usr/local/pgsql/backup&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>DATE=$(date +%Y%m%d_%H%M%S)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RETENTION_DAYS=7
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 创建备份目录
</span></span></span><span style=display:flex><span><span style=color:#e6db74>mkdir -p $BACKUP_DIR/$DATE
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;开始备份: $(date)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 备份所有数据库
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/usr/local/pgsql/bin/pg_dumpall -h localhost -U postgres \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    | gzip &gt; $BACKUP_DIR/$DATE/full_backup_$DATE.sql.gz
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 备份单个重要数据库（可选）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/usr/local/pgsql/bin/pg_dump -h localhost -U postgres test_db \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    -F c -f $BACKUP_DIR/$DATE/test_db_$DATE.dump
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;备份完成: $(date)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;备份文件:&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ls -lh $BACKUP_DIR/$DATE/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 清理旧备份
</span></span></span><span style=display:flex><span><span style=color:#e6db74>find $BACKUP_DIR -type d -mtime +$RETENTION_DAYS -exec rm -rf {} \;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>echo &#34;已清理超过${RETENTION_DAYS}天的备份&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo chmod +x /usr/local/bin/backup_postgres.sh
</span></span><span style=display:flex><span>sudo chown postgres:postgres /usr/local/bin/backup_postgres.sh
</span></span></code></pre></div><h2 id=-安装其他稳定版本>🎯 安装其他稳定版本</h2><h3 id=安装postgresql-157lts版本>安装PostgreSQL 15.7（LTS版本）</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /opt/postgresql_src
</span></span><span style=display:flex><span>wget https://ftp.postgresql.org/pub/source/v15.7/postgresql-15.7.tar.gz
</span></span><span style=display:flex><span>tar -zxvf postgresql-15.7.tar.gz
</span></span><span style=display:flex><span>cd postgresql-15.7
</span></span><span style=display:flex><span>mkdir build <span style=color:#f92672>&amp;&amp;</span> cd build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 配置（与16.2类似）</span>
</span></span><span style=display:flex><span>../configure <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --prefix<span style=color:#f92672>=</span>/usr/local/pgsql15 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-pgport<span style=color:#f92672>=</span><span style=color:#ae81ff>5433</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-openssl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-perl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --with-python
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make -j<span style=color:#66d9ef>$(</span>nproc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div><h3 id=安装postgresql-1412长期支持>安装PostgreSQL 14.12（长期支持）</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /opt/postgresql_src
</span></span><span style=display:flex><span>wget https://ftp.postgresql.org/pub/source/v14.12/postgresql-14.12.tar.gz
</span></span><span style=display:flex><span>tar -zxvf postgresql-14.12.tar.gz
</span></span><span style=display:flex><span>cd postgresql-14.12
</span></span><span style=display:flex><span>mkdir build <span style=color:#f92672>&amp;&amp;</span> cd build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>../configure --prefix<span style=color:#f92672>=</span>/usr/local/pgsql14 --with-openssl
</span></span><span style=display:flex><span>make -j<span style=color:#66d9ef>$(</span>nproc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div><h2 id=-故障排除>⚠️ 故障排除</h2><h3 id=常见问题解决>常见问题解决</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. 编译错误：缺少依赖</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 重新安装所有依赖后清理重试</span>
</span></span><span style=display:flex><span>make distclean
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 启动失败：端口被占用</span>
</span></span><span style=display:flex><span>netstat -tlnp | grep <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>sudo lsof -i :5432
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. 连接失败：认证问题</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检查pg_hba.conf配置</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. 内存不足：调整编译并行度</span>
</span></span><span style=display:flex><span>make -j2  <span style=color:#75715e># 使用更少的并行任务</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. 查看详细错误日志</span>
</span></span><span style=display:flex><span>tail -f /usr/local/pgsql/data/log/postgresql-*.log
</span></span></code></pre></div><h2 id=-总结>📝 总结</h2><h3 id=安装步骤回顾>安装步骤回顾</h3><ol><li><strong>安装依赖</strong>：确保编译环境完整</li><li><strong>下载源码</strong>：选择稳定版本（推荐16.2或15.7）</li><li><strong>配置编译</strong>：根据需求选择编译选项</li><li><strong>编译安装</strong>：使用并行编译提高速度</li><li><strong>初始化数据库</strong>：设置数据目录和编码</li><li><strong>配置参数</strong>：优化性能和安全</li><li><strong>创建服务</strong>：使用systemd管理</li><li><strong>验证测试</strong>：确保安装成功</li></ol><h3 id=版本选择建议>版本选择建议</h3><ul><li><strong>生产环境</strong>：PostgreSQL 15.x（LTS支持到2027年）</li><li><strong>学习测试</strong>：PostgreSQL 16.x（最新特性）</li><li><strong>兼容性要求</strong>：PostgreSQL 14.x（支持到2026年）</li></ul><h3 id=关键配置文件>关键配置文件</h3><ul><li><code>/usr/local/pgsql/data/postgresql.conf</code> - 主配置文件</li><li><code>/usr/local/pgsql/data/pg_hba.conf</code> - 客户端认证</li><li><code>/etc/systemd/system/postgresql.service</code> - 服务文件</li></ul><p>通过源码安装可以获得更好的性能和定制性，适合生产环境和对性能有要求的场景。</p></div></article></main><div class=pagination><span class="pagination__item pagination__item--current">1/2</span>
<a class="pagination__item pagination__item--next btn" href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/page/2/>»</a></div></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=搜索... name=q aria-label=搜索...>
</label><input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=/></form></div><div class="widget-recent widget"><h4 class=widget__title>最新文章</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E8%A7%84%E5%88%99%E5%85%A5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/>第四章：规则入微 · 服务网格</a></li><li class=widget__item><a class=widget__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E4%B8%89%E7%AB%A0-%E9%A3%9E%E5%8D%87%E4%B8%8A%E7%95%8C%E4%BA%91%E5%8E%9F%E7%94%9F%E4%B8%8EK8s/>第三章：飞升上界 · 云原生与K8s</a></li><li class=widget__item><a class=widget__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%BC%80%E5%AE%97%E7%AB%8B%E6%B4%BE%E5%88%86%E5%B8%83%E5%BC%8F%E4%BF%AE%E7%9C%9F/>第二章：开宗立派 · 分布式修真</a></li><li class=widget__item><a class=widget__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%8D%95%E6%9C%BA%E8%8B%A6%E4%BF%AE%E8%8D%89%E6%A0%B9%E5%90%AF%E7%A8%8B/>第一章：单机苦修 · 草根启程</a></li><li class=widget__item><a class=widget__link href=/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E7%94%BB%E5%8D%B7%E7%AF%87/>前端开发</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>分类</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/%e5%85%b3%e4%ba%8e%e6%88%91>关于我</a></li><li class=widget__item><a class=widget__link href=/categories/%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91>前端开发</a></li><li class=widget__item><a class=widget__link href=/categories/%e5%90%8e%e7%ab%af%e6%9e%b6%e6%9e%84>后端架构</a></li><li class=widget__item><a class=widget__link href=/categories/%e5%b7%a5%e5%85%b7%e6%95%88%e7%8e%87>工具效率</a></li><li class=widget__item><a class=widget__link href=/categories/%e5%bc%80%e6%ba%90%e6%96%87%e6%a1%a3>开源文档</a></li><li class=widget__item><a class=widget__link href=/categories/%e7%ae%97%e6%b3%95%e4%b8%80%e7%bb%9f%e6%98%a5%e7%a7%8b>算法一统春秋</a></li><li class=widget__item><a class=widget__link href=/categories/%e7%ae%97%e6%b3%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84>算法数据结构</a></li><li class=widget__item><a class=widget__link href=/categories/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80>编程语言</a></li><li class=widget__item><a class=widget__link href=/categories/%e8%bf%90%e7%bb%b4%e9%83%a8%e7%bd%b2>运维部署</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>标签</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/ai title=Ai>Ai (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c title=C>C (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ci/cd title="Ci cd">Ci cd (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/deepseek title=Deepseek>Deepseek (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/docker title=Docker>Docker (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/even-loop title="Even loop">Even loop (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/istio title=Istio>Istio (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java title=Java>Java (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/kubernetes title=Kubernetes>Kubernetes (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/loadrunner title=Loadrunner>Loadrunner (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ngrok title=Ngrok>Ngrok (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/postgresql title=Postgresql>Postgresql (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/react title=React>React (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/vue title=Vue>Vue (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e4%ba%91%e5%8e%9f%e7%94%9f title=云原生>云原生 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%86%85%e7%bd%91%e7%a9%bf%e9%80%8f title=内网穿透>内网穿透 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f title=分布式系统>分布式系统 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%88%97%e8%a1%a8 title=列表>列表 (6)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%8a%9e%e5%85%ac%e8%bd%af%e4%bb%b6 title=办公软件>办公软件 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%8d%95%e4%bd%93%e5%ba%94%e7%94%a8 title=单体应用>单体应用 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%8f%af%e8%a7%86%e5%8c%96 title=可视化>可视化 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%ae%b9%e5%99%a8%e5%8c%96 title=容器化>容器化 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%ae%b9%e5%99%a8%e7%bc%96%e6%8e%92 title=容器编排>容器编排 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%b7%a5%e7%a8%8b%e5%8c%96 title=工程化>工程化 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7 title=开发工具>开发工具 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%bc%80%e6%ba%90%e5%8d%8f%e4%bd%9c title=开源协作>开源协作 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%be%ae%e6%9c%8d%e5%8a%a1 title=微服务>微服务 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%b2%bb%e7%90%86 title=微服务治理>微服务治理 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%95%b0%e6%8d%ae%e5%ba%93 title=数据库>数据库 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%96%87%e6%a1%a3%e7%bc%96%e5%86%99 title=文档编写>文档编写 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%9c%8d%e5%8a%a1%e6%b2%bb%e7%90%86 title=服务治理>服务治理 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%9c%8d%e5%8a%a1%e7%bd%91%e6%a0%bc title=服务网格>服务网格 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%9e%b6%e6%9e%84%e4%bf%ae%e4%bb%99 title=架构修仙>架构修仙 (4)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%b5%8b%e8%af%95 title=测试>测试 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e6%b5%8b%e8%af%95%e5%b7%a5%e5%85%b7 title=测试工具>测试工具 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%89%88%e6%9c%ac%e7%ae%a1%e7%90%86 title=版本管理>版本管理 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%9b%91%e6%8e%a7%e6%97%a5%e5%bf%97 title=监控日志>监控日志 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%a4%be%e5%8c%ba%e5%bb%ba%e8%ae%be title=社区建设>社区建设 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%ad%94%e9%a2%98%e7%b3%bb%e7%bb%9f title=答题系统>答题系统 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%ae%80%e5%8e%86 title=简历>简历 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%ae%97%e6%b3%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84 title=算法数据结构>算法数据结构 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80 title=编程语言>编程语言 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e7%bd%91%e7%bb%9c%e9%9a%a7%e9%81%93 title=网络隧道>网络隧道 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e8%8b%b1%e8%af%ad%e8%af%ad%e6%b3%95 title=英语语法>英语语法 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f title=设计模式>设计模式 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e8%b7%af%e7%ba%bf%e8%a7%84%e5%88%92 title=路线规划>路线规划 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e8%bf%90%e7%bb%b4 title=运维>运维 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e9%9d%a2%e8%af%95%e9%a2%98 title=面试题>面试题 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%e9%ab%98%e5%b9%b6%e5%8f%91 title=高并发>高并发 (1)</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">社交</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/blowizer target=_blank><svg class="widget-social__link-icon icon-github" viewBox="0 0 384 374" width="24" height="24" fill="#fff"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg>
<span>GitHub</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Email href=mailto:blowizer@qq.com><svg class="widget-social__link-icon icon-mail" viewBox="0 0 416 288" width="24" height="24" fill="#fff"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg>
<span>blowizer@qq.com</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/post/about/>个人简历-中文</a> | <a class=footer__link href=/post/about-en/>个人简历-英文</a></div><div class=footer__copyright>&copy; 2025 补漏砖匠.
<span class=footer__copyright-credits><a href=# rel="nofollow noopener" target=_blank>左键右鼠运阴阳，挖山填海码几行。</a> <a href=# rel="nofollow noopener" target=_blank>人海浮沉皆过客，我是人间补漏匠。</a></span></div></div></footer></div><script async defer src=/js/menu.js></script><script src=/js/quiz.js></script><script src=/js/ai-quiz.js></script></body></html>