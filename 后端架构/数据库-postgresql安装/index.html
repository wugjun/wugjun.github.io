<!doctype html><html class=no-js lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>典籍篇</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="开源文档典籍篇汇总"><meta name=generator content="Hugo 0.128.0"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a class=logo__link href=/ title=补漏砖匠 rel=home><div class=logo__title>补漏砖匠</div><div class=logo__tagline>独钓寒江雪，为有暗香来。</div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/>兵法篇</a></li><li class=menu__item><a class=menu__link href=/%E5%BC%80%E6%BA%90%E6%96%87%E6%A1%A3/%E5%BC%80%E6%BA%90%E6%96%87%E6%A1%A3-%E5%85%B8%E7%B1%8D%E7%AF%87/>典籍篇</a></li><li class=menu__item><a class=menu__link href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-%E5%89%91%E6%B3%95%E7%AF%87/>剑法篇</a></li><li class=menu__item><a class=menu__link href=/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2-%E6%9C%BA%E5%85%B3%E7%AF%87/>机关篇</a></li><li class=menu__item><a class=menu__link href=/%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A3%8B%E8%B0%B1%E7%AF%87/>棋谱篇</a></li><li class=menu__item><a class=menu__link href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B3%95%E5%AE%9D%E7%AF%87/>法宝篇</a></li><li class=menu__item><a class=menu__link href=/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91--%E7%94%BB%E5%8D%B7%E7%AF%87/>画卷篇</a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>典籍篇</h1><p class=post__lead>聚社区之智，传技术之火</p><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2021-12-21T00:00:00>December 21, 2021</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%bc%80%e6%ba%90%e6%96%87%e6%a1%a3 rel=category>开源文档</a></span></div></div></header><div class="content post__content clearfix"><p><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/>◀ 返回</a></p><h3 id=postgresql-安装>PostgreSQL 安装</h3><h4 id=创建用户与环境配置>创建用户与环境配置</h4><ol><li>创建用户</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>groupadd postgres
</span></span><span style=display:flex><span>useradd -g postgres postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>环境变量配置<span style=color:#f92672>(</span>.bash_profile<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export PGPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5433</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export PG_HOME<span style=color:#f92672>=</span>/usr/local/pg16.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$PG_HOME/bin:$PATH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export PGDATA<span style=color:#f92672>=</span>$PG_HOME/data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export LD_LIBRARY_PATH<span style=color:#f92672>=</span>$PG_HOME/lib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export LANG<span style=color:#f92672>=</span>en_US.utf8
</span></span></code></pre></div><ol start=2><li>内核参数配置</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vi /etc/sysctl.conf
</span></span><span style=display:flex><span><span style=color:#75715e>#最大共享内存段大小</span>
</span></span><span style=display:flex><span>kernel.shmmax <span style=color:#f92672>=</span> 68719476736<span style=color:#f92672>(</span>默认<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span> <span style=color:#75715e>#可以使用的共享内存的总量</span>
</span></span><span style=display:flex><span>kernel.shmall <span style=color:#f92672>=</span> 4294967296<span style=color:#f92672>(</span>默认<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#整个系统共享内存段的最大数目</span>
</span></span><span style=display:flex><span>kernel.shmmni <span style=color:#f92672>=</span> <span style=color:#ae81ff>4096</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#每个信号对象集的最大信号对象数</span>
</span></span><span style=display:flex><span>kernel.sem <span style=color:#f92672>=</span> <span style=color:#ae81ff>50100</span> <span style=color:#ae81ff>64128000</span> <span style=color:#ae81ff>50100</span> <span style=color:#ae81ff>1280</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#文件句柄的最大数量。</span>
</span></span><span style=display:flex><span>fs.file-max <span style=color:#f92672>=</span> <span style=color:#ae81ff>7672460</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#应用程序可使用的IPv4端口范围</span>
</span></span><span style=display:flex><span>net.ipv4.ip_local_port_range <span style=color:#f92672>=</span> <span style=color:#ae81ff>9000</span> <span style=color:#ae81ff>65000</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#套接字接收缓冲区大小的缺省值</span>
</span></span><span style=display:flex><span>net.core.rmem_default <span style=color:#f92672>=</span> <span style=color:#ae81ff>1048576</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#套接字发送缓冲区大小的缺省</span>
</span></span><span style=display:flex><span>net.core.wmem_default <span style=color:#f92672>=</span> <span style=color:#ae81ff>262144</span> 值
</span></span><span style=display:flex><span><span style=color:#75715e>#套接字发送缓冲区大小的最大值</span>
</span></span><span style=display:flex><span>net.core.wmem_max <span style=color:#f92672>=</span> <span style=color:#ae81ff>1048576</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sysctl -p #配置生效</span>
</span></span></code></pre></div><ol start=3><li>centos7 源码安装</li></ol><ul><li><p><a href=https://www.postgresql.org/ftp/source/>下载</a></p></li><li><p>依赖包检查</p></li></ul><blockquote><p><strong>最小依赖</strong>：<em>gcc、gcc-c++、zlib-devel、readline-devel</em></p></blockquote><blockquote><p><strong>其他依赖</strong>：<em>perl-ExtUtils-Embed、pam-devel、libxml2-devel、libxslt-devel、openldap-devel、python-devel、openssl-devel、cmake</em></p></blockquote><ul><li>安装</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ su - postgres
</span></span><span style=display:flex><span>$ cd /soft/postgresql-16.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ./configure --prefix<span style=color:#f92672>=</span>/usr/local/pg16.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ make
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ make install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Configure常用配置选项：</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## prefix：指定安装路径</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## with-openssl：对openssl进行扩展支持</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## with-python：对python进行扩展支持</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## with-perl：对perl进行扩展支持</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## with-libxml：对xml进行扩展支持</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./configure --prefix<span style=color:#f92672>=</span>/usr/local/pg16.2 --with-pgport<span style=color:#f92672>=</span><span style=color:#ae81ff>1922</span> --with-openssl --with-perl --with-tcl --with-python --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span> --with-blocksize<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span> --enable-dtrace --enable-debug
</span></span><span style=display:flex><span>--with-blocksize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 如果数据库需要经常做插入的操作，数据量增长非常快，尽量把此参数设大一点;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 经常做小数据查询、更新且内存不是非常大的时候可以设小一点，默认8K即可。</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 生产环境不要加--enable-dtrace --enable-debug</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## gmakeworld包括第三方插件全部编译</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## gmakecheck-world需要使用普通用户执行，可选，耗时较长</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## gmakeinstall包括第三方插件全部安装</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## gmakeworld安装包含了文档，所有的contirb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 安装前先创建好/usr/local/pg16.6目录，同时授权postgres用户可读写权限</span>
</span></span></code></pre></div><h2 id=pg-的建库与使用>PG 的建库与使用</h2><h3 id=创建数据库集簇>创建数据库集簇</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. 创建目录</span>
</span></span><span style=display:flex><span>mkdir /usr/local/pg16.6/data
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 初始化数据库集簇</span>
</span></span><span style=display:flex><span>initdb -D $PG_DATA -W --data-checksums 
</span></span></code></pre></div><h3 id=数据库打开和关闭>数据库打开和关闭</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 1. 启动数据库</span>
</span></span><span style=display:flex><span>pg_ctl -D $PG
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 关闭数据库</span>
</span></span><span style=display:flex><span>pg_ctl -D $PG_DATA stop
</span></span><span style=display:flex><span><span style=color:#75715e># 3. 登录数据库</span>
</span></span><span style=display:flex><span>pgsql -U postgres
</span></span><span style=display:flex><span><span style=color:#75715e># 4. 退出数据哭</span>
</span></span><span style=display:flex><span>&gt;<span style=color:#ae81ff>\q</span>
</span></span></code></pre></div><h3 id=数据库的使用>数据库的使用</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 1. 查看帮助</span>
</span></span><span style=display:flex><span>&gt;help
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 执行 pgsql 命令</span>
</span></span><span style=display:flex><span>&gt;<span style=color:#ae81ff>\l</span>
</span></span><span style=display:flex><span>&gt;select * from tab_name;
</span></span></code></pre></div><h2 id=pg的实例>PG的实例</h2><p><img src=/images/Postgresql%E5%AE%89%E8%A3%85%E5%9B%BE1.png alt="PG 实例"></p><h3 id=参数文件>参数文件</h3><ol><li>静态参数文件: <strong>postgresql.conf</strong></li></ol><blockquote><p>使用操作系统编辑器手动修改，更改在下次启动生效,仅在实例启动期间读取，默认位置$PG_DATA</p></blockquote><p>动态参数文件: <strong>postgresql.auto.conf</strong></p><blockquote><p>由 postgrsql 服务器维护，支持用文本编辑器修改（不推荐），alter sysetem 命令修改的参数保存在该文件，能够在关闭和启动期间持续进行更改，可以实现参数的自我调整。默认位置$PG_DATA,改变一个参数的值，会在文件中自动添加参数，alter system set archive_mode= on，恢复一个参数默认值，会在文件中自动删除参数。</p></blockquote><p>可选参数文件: <strong>postgresql.conf.user</strong></p><ol start=2><li>参数生效条件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> name ,setting,context <span style=color:#66d9ef>from</span> pg_settings <span style=color:#66d9ef>where</span> name <span style=color:#66d9ef>in</span>(<span style=color:#e6db74>&#39;port&#39;</span>,<span style=color:#e6db74>&#39;work_mem&#39;</span>,<span style=color:#e6db74>&#39;log_statement&#39;</span>,<span style=color:#e6db74>&#39;log_checkpoints&#39;</span>);
</span></span></code></pre></div><p><img src=/images/Postgresql%E5%AE%89%E8%A3%85%E5%9B%BE2.png alt=pg_settings></p><p><strong>sighup</strong>: 表示需要超级管理员修改，reload 就能够生效。</p><p><strong>superuser</strong>: 表示使用超级管理员可以为普通用户、数据库、或者超级管理员自己修改。</p><p><strong>postmaster</strong>: 表示需要超级管理员修改，需要重启才能够生效。</p><p><strong>user</strong>: 表示普通用户可以修改参数值，立即生效。</p><hr><p><a href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/>◀ 返回</a></p></div><div class="post__tags tags clearfix"><svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373.0-.74-.24-1-.5L1 8A2.853 2.853.0 01.3 7C.113 6.55.0 5.973.0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034.0 1.4.0h4.2c.373.0.95.113 1.4.3s.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5.0 100-3 1.5 1.5.0 000 3z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/postgresql/ rel=tag>postgresql</a></li></ul></div></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="wu guojun avatar" src=/img/QR.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About wu guojun</span></div><div class=authorbox__description>北京牛马，高级 CV工程狮</div></div><nav class="post-nav flex"><div class="post-nav__item post-nav__item--prev"><a class=post-nav__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E6%95%B0%E6%8D%AE%E5%BA%93-postgresql%E7%BB%84%E6%88%90%E7%BB%93%E6%9E%84/ rel=prev><span class=post-nav__caption>«&#8201;Previous</span><p class=post-nav__post-title>典籍篇</p></a></div><div class="post-nav__item post-nav__item--next"><a class=post-nav__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/ rel=next><span class=post-nav__caption>Next&#8201;»</span><p class=post-nav__post-title>兵法篇</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/post/about/>个人简历-中文</a> | <a class=footer__link href=/post/about-en/>个人简历-英文</a></div><div class=footer__copyright>&copy; 2025 补漏砖匠.
<span class=footer__copyright-credits><a href=# rel="nofollow noopener" target=_blank>左键右鼠运阴阳，挖山填海码几行。</a> <a href=# rel="nofollow noopener" target=_blank>人海浮沉皆过客，我是人间补漏匠。</a></span></div></div></footer></div><script async defer src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>