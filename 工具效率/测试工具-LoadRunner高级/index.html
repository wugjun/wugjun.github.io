<!doctype html><html class=no-js lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>法宝篇</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="工具效率法宝篇汇总"><meta name=generator content="Hugo 0.128.0"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a class=logo__link href=/ title=补漏砖匠 rel=home><div class=logo__title>补漏砖匠</div><div class=logo__tagline>独钓寒江雪，为有暗香来。</div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84/%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84-%E5%85%B5%E6%B3%95%E7%AF%87/>兵法篇</a></li><li class=menu__item><a class=menu__link href=/%E5%BC%80%E6%BA%90%E6%96%87%E6%A1%A3/%E5%BC%80%E6%BA%90%E6%96%87%E6%A1%A3-%E5%85%B8%E7%B1%8D%E7%AF%87/>典籍篇</a></li><li class=menu__item><a class=menu__link href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-%E5%89%91%E6%B3%95%E7%AF%87/>剑法篇</a></li><li class=menu__item><a class=menu__link href=/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2-%E6%9C%BA%E5%85%B3%E7%AF%87/>机关篇</a></li><li class=menu__item><a class=menu__link href=/%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A3%8B%E8%B0%B1%E7%AF%87/>棋谱篇</a></li><li class=menu__item><a class=menu__link href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B3%95%E5%AE%9D%E7%AF%87/>法宝篇</a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>法宝篇</h1><p class=post__lead>工欲善其事，必先利其器</p><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16s8-3.6 8-8.0000003c0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4s6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8L11.36 11.36l.64-1.04-3.6-2.1600003z"/></svg>
<time class=meta__text datetime=2021-12-21T00:00:00>December 21, 2021</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg>
<span class=meta__text><a class=meta__link href=/categories/%e5%b7%a5%e5%85%b7%e6%95%88%e7%8e%87 rel=category>工具效率</a></span></div></div></header><div class="content post__content clearfix"><p><a href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B3%95%E5%AE%9D%E7%AF%87/>◀ 返回</a></p><h3 id=创建脚本>创建脚本</h3><h4 id=创建>创建</h4><p><img src=/images/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7-loadrunner.png alt="创建socket script"></p><h3 id=录制>录制</h3><ul><li><p>截取报文
<img src=/images/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7-%E5%BD%95%E5%88%B6.png alt=报文></p></li><li><p>替换空格和换行<img src=/images/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7-%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC.png alt=替换空格和换行></p></li><li><p>创建socket
![创建socket](/images/工具效率-测试工具-创建socket.png</p></li><li><p>loadrunner gennerator 中ctrl+r 录制发送报文 生成如下内容</p></li></ul><blockquote><p>参数化流水号,右健所选内容,命名为seqNum_6 格式为%lu6
<img src=/images/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7-%E6%8F%90%E5%8F%96%E5%8F%82%E6%95%B0.png alt=提取参数></p></blockquote><p>在Action.c 中添加代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>/*********************************************************************
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Created by Windows Sockets Recorder
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Created on: Wed Jun 16 11:06:06
</span></span></span><span style=display:flex><span><span style=color:#75715e> *********************************************************************/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;lrs.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Action</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>Data, <span style=color:#f92672>*</span>p,<span style=color:#f92672>*</span>q;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> Size;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> index[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> hexStr[<span style=color:#ae81ff>20</span>]<span style=color:#f92672>=</span>{<span style=color:#ae81ff>0</span>};
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> strByte[<span style=color:#ae81ff>20</span>]<span style=color:#f92672>=</span>{<span style=color:#ae81ff>0</span>};
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> hexByte[<span style=color:#ae81ff>20</span>]<span style=color:#f92672>=</span>{<span style=color:#ae81ff>0</span>};
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>unitptr;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> rSeqNum[<span style=color:#ae81ff>20</span>] <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>};
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> len <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> i,j,k,ret;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> z <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//设定开始事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> 
</span></span><span style=display:flex><span>    len <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(<span style=color:#a6e22e>lr_eval_string</span>(<span style=color:#e6db74>&#34;{seqNum_6}&#34;</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    p <span style=color:#f92672>=</span> <span style=color:#a6e22e>lr_eval_string</span>(<span style=color:#e6db74>&#34;{seqNum_6}&#34;</span>) ;
</span></span><span style=display:flex><span>    ret <span style=color:#f92672>=</span> <span style=color:#a6e22e>str2hex</span>(rSeqNum,<span style=color:#ae81ff>6</span>,p);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;str=%s, len = %d&#34;</span>,p, ret);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;str=%s, len = %d&#34;</span>,rSeqNum, ret);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>HexStrTobyte</span>(p,hexByte,<span style=color:#f92672>&amp;</span>len);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (i <span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i <span style=color:#f92672>&lt;</span> len ; i<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    	<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;str=%02x,&#34;</span>,hexByte[i]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    q <span style=color:#f92672>=</span> hexStr;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;str=%s&#34;</span>,p);
</span></span><span style=display:flex><span>   len <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(p);
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (j<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; j<span style=color:#f92672>&lt;</span>len<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span> ; j<span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>   		<span style=color:#a6e22e>memcpy</span>(q,<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>x&#34;</span>,<span style=color:#ae81ff>2</span>);  
</span></span><span style=display:flex><span>   		<span style=color:#a6e22e>memcpy</span>(q<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>, p,<span style=color:#ae81ff>2</span>);  		
</span></span><span style=display:flex><span>   		p<span style=color:#f92672>+=</span><span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>   		q<span style=color:#f92672>+=</span><span style=color:#ae81ff>4</span>;	
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;str=%s&#34;</span>,hexStr);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lr_save_string</span>(hexStr,<span style=color:#e6db74>&#34;seqN&#34;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span> <span style=color:#75715e>#if 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>lrs_startup</span>(<span style=color:#ae81ff>257</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>//创建socketS
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>lr_start_transaction</span>(<span style=color:#e6db74>&#34;create_socket&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    rc <span style=color:#f92672>=</span> <span style=color:#a6e22e>lrs_create_socket</span>(<span style=color:#e6db74>&#34;socket0&#34;</span>, <span style=color:#e6db74>&#34;TCP&#34;</span>, <span style=color:#e6db74>&#34;RemoteHost=127.0.0.1:32001&#34;</span>,  LrsLastArg);
</span></span><span style=display:flex><span>	<span style=color:#75715e>//判断套接字创建是否成功
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (rc<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;create_socket&#34;</span>, LR_PASS); 
</span></span><span style=display:flex><span>    	<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;Socket was successfully send &#34;</span>);
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;create_socket&#34;</span>, LR_FAIL); 
</span></span><span style=display:flex><span>    	<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;An error occurred while closing the socket, Error Code: %d&#34;</span>, rc);
</span></span><span style=display:flex><span>    	
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>//判断socket是否链接成功的事务，0表示创建成功 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>lr_start_transaction</span>(<span style=color:#e6db74>&#34;send_socket&#34;</span>);   
</span></span><span style=display:flex><span>	<span style=color:#75715e>//发送安全会话建立请求buf0为在data.ws中定义的发送变量     
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>lrs_send</span>(<span style=color:#e6db74>&#34;socket0&#34;</span>, <span style=color:#e6db74>&#34;buf0&#34;</span>, LrsLastArg);
</span></span><span style=display:flex><span> 	<span style=color:#75715e>//设置连接超时时间为1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>lrs_set_recv_timeout</span>(<span style=color:#ae81ff>45</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (rc<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;send_socket&#34;</span>, LR_PASS); 
</span></span><span style=display:flex><span>    	<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;Socket was successfully send &#34;</span>);
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;send_socket&#34;</span>, LR_FAIL); 
</span></span><span style=display:flex><span>    	<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;An error occurred while send the socket, Error Code: %d&#34;</span>, rc);
</span></span><span style=display:flex><span>    	
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>//设置接收超时时间为1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//lrs_set_recv_timeout2(45,0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;Socket was successfully send&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//接收消息，存放在buf1中，buf1是在data.ws中定义的接收数组，注意数组长度一定要大于等于实际接收长度
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>lrs_receive</span>(<span style=color:#e6db74>&#34;socket0&#34;</span>, <span style=color:#e6db74>&#34;buf1&#34;</span>, LrsLastArg); 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//把Socket最后接收的字节数组，长度放在recvlen中，内容放在recvbuf中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//lrs_get_last_received_buffer(&#34;socket0&#34;,&amp;recvbuf,&amp;recvlen);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>lr_start_transaction</span>(<span style=color:#e6db74>&#34;received_socket&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#75715e>//lrs_save_param(&#34;socket0&#34;, NULL, &#34;F39&#34;, 39, 2);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//lr_message (&#34;F39: %s&#34;, lr_eval_string(&#34;{F39}&#34;));
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>lrs_get_last_received_buffer</span>(<span style=color:#e6db74>&#34;socket0&#34;</span>,<span style=color:#f92672>&amp;</span>Data,<span style=color:#f92672>&amp;</span>Size);
</span></span><span style=display:flex><span>	<span style=color:#75715e>//lr_message(&#34;报文内容:%s&#34;,Data);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//lr_message(&#34;应答码第39位:%x&#34;,Data[39]);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//lr_message(&#34;应答码第40位:%x&#34;,Data[40]);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>//获取流水号000000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(Size <span style=color:#f92672>==</span> <span style=color:#ae81ff>116</span>){
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;接收报文长度 116 == %d&#34;</span>, Size);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;received_socket&#34;</span>, LR_PASS);
</span></span><span style=display:flex><span>	}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;接收报文长度不够116 != %d&#34;</span>, Size);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;received_socket&#34;</span>, LR_FAIL);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//memcpy(F39,lr_eval_string(&#34;{F39}&#34;),2);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//lr_output_message(&#34;recvbuf: %X&#34;,recvbuf);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	 <span style=color:#a6e22e>lr_start_transaction</span>(<span style=color:#e6db74>&#34;ITMP-9121-A0-33&#34;</span>);	
</span></span><span style=display:flex><span>	<span style=color:#75715e>//获取流水号000000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//if(Data[32]==0x45&amp;&amp;Data[33]==0x34){
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>memcpy</span>(rSeqNum, Data<span style=color:#f92672>+</span><span style=color:#ae81ff>31</span>,<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>memcmp</span>(Data<span style=color:#f92672>+</span><span style=color:#ae81ff>31</span>,hexByte,<span style=color:#ae81ff>3</span>)){
</span></span><span style=display:flex><span>    	
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_log_message</span>(<span style=color:#e6db74>&#34;流水号位：%3.3s&#34;</span>,Data<span style=color:#f92672>+</span><span style=color:#ae81ff>32</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;交易流水一致&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;ITMP-9121-A0-33&#34;</span>, LR_PASS);
</span></span><span style=display:flex><span>	}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_log_message</span>(<span style=color:#e6db74>&#34;流水号4位：%x&#34;</span>,Data[<span style=color:#ae81ff>33</span>]);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;交易流水不一致&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;ITMP-9121-A0-33&#34;</span>, LR_FAIL);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>lr_start_transaction</span>(<span style=color:#e6db74>&#34;ITMP-9121-A0&#34;</span>);
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>//获取应答码000000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(Data[<span style=color:#ae81ff>39</span>]<span style=color:#f92672>==</span><span style=color:#ae81ff>0x41</span><span style=color:#f92672>&amp;&amp;</span>Data[<span style=color:#ae81ff>40</span>]<span style=color:#f92672>==</span><span style=color:#ae81ff>0x30</span>){
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;交易成功&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;ITMP-9121-A0&#34;</span>, LR_PASS);
</span></span><span style=display:flex><span>	}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_output_message</span>(<span style=color:#e6db74>&#34;交易失败&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>lr_end_transaction</span>(<span style=color:#e6db74>&#34;ITMP-9121-A0&#34;</span>, LR_FAIL); 
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>//关闭socket
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>lrs_close_socket</span>(<span style=color:#e6db74>&#34;socket0&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#75715e>//lrs_free_buffer(lseqNum);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>} 
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test_printf5</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>str, <span style=color:#66d9ef>int</span> length)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> iii;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;the str is:&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (iii <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; iii <span style=color:#f92672>&lt;</span> length; iii<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%02x &#34;</span>, str[iii]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>/*str to hex,
</span></span></span><span style=display:flex><span><span style=color:#75715e>字符串转换为16进制
</span></span></span><span style=display:flex><span><span style=color:#75715e>利用snprintf 函数
</span></span></span><span style=display:flex><span><span style=color:#75715e>int snprintf(char* dest_str,size_t size,const char* format,...);
</span></span></span><span style=display:flex><span><span style=color:#75715e>功能:将可变参数以format的格式转换到dest_str中，并可以用%s打印出来。
</span></span></span><span style=display:flex><span><span style=color:#75715e>1、dest_str:目标字符串，即输出字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e>2、size: 转换字符控制长度。
</span></span></span><span style=display:flex><span><span style=color:#75715e>(1) 如果格式化后的字符串长度 &lt; size，则将此字符串全部复制到str中，并给其后添加一个字符串结束符(&#39;\0&#39;)；
</span></span></span><span style=display:flex><span><span style=color:#75715e>(2) 如果格式化后的字符串长度 &gt;= size，则只将其中的(size-1)个字符复制到str中，并给其后添加一个字符串结束符(&#39;\0&#39;)，返回值为欲写入的字符串长度。
</span></span></span><span style=display:flex><span><span style=color:#75715e>3、format :转换为某个格式，例如：%2d,%04X,%02X。
</span></span></span><span style=display:flex><span><span style=color:#75715e>4、...:需要转换的字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>str2hex</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>out_string, <span style=color:#66d9ef>int</span> length, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>in_string)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> index;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>fmt <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;%02x&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (index <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; index <span style=color:#f92672>&lt;</span> length; index<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>snprintf</span>((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>out_string[index <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>3</span>, fmt, in_string[index]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (length <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>HexStrTobyte</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>str, <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>out, <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>outlen)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> str;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> high <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, low <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> tmplen <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(p), cnt <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    tmplen <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(p);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (cnt <span style=color:#f92672>&lt;</span> (tmplen <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        high <span style=color:#f92672>=</span> ((<span style=color:#f92672>*</span>p <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;9&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> ((<span style=color:#f92672>*</span>p <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;F&#39;</span>) <span style=color:#f92672>||</span> (<span style=color:#f92672>*</span>p <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;f&#39;</span>))) <span style=color:#f92672>?</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>-</span> <span style=color:#ae81ff>48</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>:</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>-</span> <span style=color:#ae81ff>48</span>;
</span></span><span style=display:flex><span>        low <span style=color:#f92672>=</span> (<span style=color:#f92672>*</span>(<span style=color:#f92672>++</span>p) <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;9&#39;</span> <span style=color:#f92672>&amp;&amp;</span> ((<span style=color:#f92672>*</span>p <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;F&#39;</span>) <span style=color:#f92672>||</span> (<span style=color:#f92672>*</span>p <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;f&#39;</span>))) <span style=color:#f92672>?</span> <span style=color:#f92672>*</span>(p)<span style=color:#f92672>-</span><span style=color:#ae81ff>48</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>:</span> <span style=color:#f92672>*</span>(p)<span style=color:#f92672>-</span><span style=color:#ae81ff>48</span>;
</span></span><span style=display:flex><span>        out[cnt] <span style=color:#f92672>=</span> ((high <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x0f</span>) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span> (low <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x0f</span>));
</span></span><span style=display:flex><span>        p<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        cnt<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (tmplen <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        out[cnt] <span style=color:#f92672>=</span> ((<span style=color:#f92672>*</span>p <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;9&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> ((<span style=color:#f92672>*</span>p <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;F&#39;</span>) <span style=color:#f92672>||</span> (<span style=color:#f92672>*</span>p <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;f&#39;</span>))) <span style=color:#f92672>?</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>-</span> <span style=color:#ae81ff>48</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>:</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>-</span> <span style=color:#ae81ff>48</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (outlen <span style=color:#f92672>!=</span> NULL)
</span></span><span style=display:flex><span>        <span style=color:#f92672>*</span>outlen <span style=color:#f92672>=</span> tmplen <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> tmplen <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> tmplen <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> tmplen <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>byteToHexStr</span>(<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> byte_arr[], <span style=color:#66d9ef>int</span> arr_len, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>HexStr, <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>HexStrLen)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> i, index <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> arr_len; i<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> hex1;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> hex2;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> value <span style=color:#f92672>=</span> byte_arr[i];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> v1 <span style=color:#f92672>=</span> value <span style=color:#f92672>/</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> v2 <span style=color:#f92672>=</span> value <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (v1 <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> v1 <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span>            hex1 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span>)(<span style=color:#ae81ff>48</span> <span style=color:#f92672>+</span> v1);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            hex1 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span>)(<span style=color:#ae81ff>55</span> <span style=color:#f92672>+</span> v1);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (v2 <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> v2 <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span>            hex2 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span>)(<span style=color:#ae81ff>48</span> <span style=color:#f92672>+</span> v2);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            hex2 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span>)(<span style=color:#ae81ff>55</span> <span style=color:#f92672>+</span> v2);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>*</span>HexStrLen <span style=color:#f92672>&lt;=</span> i)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        HexStr[index<span style=color:#f92672>++</span>] <span style=color:#f92672>=</span> hex1;
</span></span><span style=display:flex><span>        HexStr[index<span style=color:#f92672>++</span>] <span style=color:#f92672>=</span> hex2;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>HexStrLen <span style=color:#f92672>=</span> index;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p><a href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B3%95%E5%AE%9D%E7%AF%87/>◀ 返回</a></p></div><div class="post__tags tags clearfix"><svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373.0-.74-.24-1-.5L1 8A2.853 2.853.0 01.3 7C.113 6.55.0 5.973.0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034.0 1.4.0h4.2c.373.0.95.113 1.4.3s.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5.0 100-3 1.5 1.5.0 000 3z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E6%B5%8B%E8%AF%95/ rel=tag>测试</a></li><li class=tags__item><a class="tags__link btn" href=/tags/loadrunner/ rel=tag>loadrunner</a></li><li class=tags__item><a class="tags__link btn" href=/tags/C/ rel=tag>C</a></li></ul></div></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="wu guojun avatar" src=/img/QR.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About wu guojun</span></div><div class=authorbox__description>北京牛马，高级 CV工程狮</div></div><nav class="post-nav flex"><div class="post-nav__item post-nav__item--next"><a class=post-nav__link href=/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87/%E5%B7%A5%E5%85%B7%E6%95%88%E7%8E%87-%E6%B3%95%E5%AE%9D%E7%AF%87/ rel=next><span class=post-nav__caption>Next&#8201;»</span><p class=post-nav__post-title>法宝篇</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/post/about/>个人简历-中文</a> | <a class=footer__link href=/post/about-en/>个人简历-英文</a></div><div class=footer__copyright>&copy; 2025 补漏砖匠.
<span class=footer__copyright-credits><a href=# rel="nofollow noopener" target=_blank>左键右鼠运阴阳，挖山填海码几行。</a> <a href=# rel="nofollow noopener" target=_blank>人海浮沉皆过客，我是人间补漏匠。</a></span></div></div></footer></div><script async defer src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>